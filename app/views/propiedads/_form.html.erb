<script src="http://maps.googleapis.com/maps/api/js?sensor=TRUE"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script>
	$(document).ready(function() {
		$("#propiedad_tipo_propiedad_id").change(function() {
			switch ($(this).val()) {
			case "1":
			//casa
			case "3":
			//ph
			case "6":
				//quinta
				$("#opc_antiguedad").show();
				$("#opc_ambientes").show();
				$("#opc_dormitorios").show();
				break;
			case "2":
				$("#opc_antiguedad").show();
				$("#opc_ambientes").show();
				$("#propiedad_dormitorios").val('');
				$("#opc_dormitorios").hide();
				break;
			case "5":
			//terreno
			case "7":
			//campo
			case "8":
			//galpón
			case "13":
				//bóveda
				$("#propiedad_antiguedad").val('');
				$("#opc_antiguedad").hide();
				$("#propiedad_ambientes").val('');
				$("#opc_ambientes").hide();
				$("#propiedad_dormitorios").val('');
				$("#opc_dormitorios").hide();
				break;
			default:
				$("#opc_antiguedad").show();
				$("#propiedad_ambientes").val('');
				$("#opc_ambientes").hide();
				$("#propiedad_dormitorios").val('');
				$("#opc_dormitorios").hide();
			}
		});
	}); 
</script>
<script>
	$(document).ready(function() {
		$("#propiedad_operacion_id").change(function() {
			switch ($(this).val()) {
			case "1":
				//venta
				$("#opc_expensas").hide();
				$("#propiedad_expensas").val('');
				break;
			default:
				$("#opc_expensas").show();
			}
		});
	}); 
</script>
<script>
	$(document).ready(function() {
		$("#propiedad_tipo_publicacion_id").change(function() {
		switch ($(this).val()) {
		case "2":
			$("#importe").text("$<%= TipoPublicacion.find(2).importe %>");
			break;
		case "3":
			$("#importe").text("$<%= TipoPublicacion.find(3).importe %>");
			break;
		default:			
			//gratuita
			$("#datosTarjeta").hide();		    
			break;		
		}
		});
	}); 
</script>
<script>
	$(document).ready(function() {
 		switch ($("#propiedad_tipo_publicacion_id").val()) {
		case "2":
			$("#importe").text("$<%= TipoPublicacion.find(2).importe %>");
			break;
		case "3":
			$("#importe").text("$<%= TipoPublicacion.find(3).importe %>");
			break;
		default:			
			//gratuita
			$("#datosTarjeta").hide();		    
			break;		
		}
	}); 
</script>
<script>
	$(document).ready(function() {
			switch ($("#propiedad_operacion_id").val()) {
			case "1":
				//venta
				$("#opc_expensas").hide();
				$("#propiedad_expensas").val('');
				break;
			default:
				$("#opc_expensas").show();
			}			
		}); 
</script>
<script>
	$(document).ready(function() {
		switch($("#propiedad_tipo_propiedad_id").val()) {
		case "1":
		//casa
		case "3":
		//ph
		case "6":
			//quinta
			$("#opc_antiguedad").show();
			$("#opc_ambientes").show();
			$("#opc_dormitorios").show();
			break;
		case "2":
			$("#opc_antiguedad").show();
			$("#opc_ambientes").show();
			$("#propiedad_dormitorios").val('');
			$("#opc_dormitorios").hide();
			break;
		case "5":
		//terreno
		case "7":
		//campo
		case "8":
		//galpón
		case "13":
			//bóveda
			$("#propiedad_antiguedad").val('');
			$("#opc_antiguedad").hide();
			$("#propiedad_ambientes").val('');
			$("#opc_ambientes").hide();
			$("#propiedad_dormitorios").val('');
			$("#opc_dormitorios").hide();
			break;
		default:
			$("#opc_antiguedad").show();
			$("#propiedad_ambientes").val('');
			$("#opc_ambientes").hide();
			$("#propiedad_dormitorios").val('');
			$("#opc_dormitorios").hide();
		}
	}); 	
</script>
<div class="container" style="width:400px">
	<%= form_for(@propiedad) do |f| %>
	<% if @propiedad.errors.any? %>
	<div id="error_explanation">
		<h2>Se encontraron los siguientes errores:</h2>
		<ul>
			<% @propiedad.errors.full_messages.each do |message| %>
			<li>
				<%= message %>
			</li>
			<% end %>
		</ul>
	</div>
	<% end %>

	<p class="obligatorio center">(*)Obligatorio</p>

	<h2>Datos de operaci&oacute;n</h2>
	<hr>
	<div class="camposInline" >
		<span class="obligatorio">&nbsp</span>
		<%= f.label "Tipo de publicación" %>
		
		<% if params[:action] == "new" || params[:action] == "create" %>	
		  <%= f.collection_select :tipo_publicacion_id, TipoPublicacion.all, :id,
	      :nombre, :selected => @propiedad.tipo_publicacion_id %>       
	    <% else %>      
	      <%= f.text_field :tipo_publicacion_id, :value => @propiedad.tipo_publicacion.nombre, :disabled => true %>        
	    <% end %>    
	    
	</div>
	<div class="camposInline" >
		<span class="obligatorio">*</span>
		<%= f.label "Fecha de publicación" %>
			
		<% if params[:action] == "new" || params[:action] == "create" %>	
		  <%= date_field :propiedad, :fecha_publicacion, :min => Date.today, :value => Date.today%>
		<% else %>
		  <%= date_field :propiedad, :fecha_publicacion, :disabled =>true %>
		<% end %>
	</div>


	<div class="camposInline" >
		<span class="obligatorio">&nbsp</span>
		<%= f.label :tipo_propiedad_id,"Tipo de propiedad" %>
		<%= f.collection_select :tipo_propiedad_id, TipoPropiedad.all, :id,
	    :nombre, :selected => @propiedad.tipo_propiedad_id %>
	</div>
	<div class="camposInline" >
		<span class="obligatorio">&nbsp</span>
		<%= f.label :operacion_id,"Operación" %>
		<%= f.collection_select :operacion_id, Operacion.all, :id, :tipo,
		:selected => @propiedad.operacion_id %>
	</div>

	<br>
	<h2>Ubicación</h2>
	<hr>
	<div class="field camposInline">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :barrio_id %>
		<%= f.collection_select :barrio_id, Barrio.all, :id, :nombre, :selected => @propiedad.barrio_id %>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">*</span>
		<%= f.label :direccion,"Dirección" %>
		<%= f.text_field :direccion %>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">*</span>
		<%= f.label :numero, "Número" %>	
		<%= f.text_field :numero, :class=>"campoCorto" %>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :piso %>
		<%= f.text_field :piso, :class=>"campoCorto" %>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :departamento %>
		<%= f.text_field :departamento, :class=>"campoCorto" %>
	</div>

	<div class="field center">
	<p>  
	  <strong hidden="true" >Latitude:</strong>  
	  <span id="latitude" hidden="true" ><%= @propiedad.latitude %> </span> 
	</p>  
	<p>  
	  <strong hidden="true" >>Longitude:</strong>  
	  <span id="longitude" hidden="true" ><%= @propiedad.longitude %> </span> 
	</p>
	<%= image_tag "http://maps.google.com/maps/api/staticmap?size=450x300&sensor=false&zoom=16&markers=#{@propiedad.latitude}%2C#{@propiedad.longitude}",
	 :id => "mapa" %>
	</div> 

	<div class="field">
	<br>
	<h2>Datos del inmueble</h2>
	<hr>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">*</span>
		<%= f.label :descripcion,"Descripción" %>
		<%= f.text_area :descripcion %>
	</div>
	<div class="field camposInline" id="opc_antiguedad" style="display:none;">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :antiguedad,"Antigüedad" %>
		<%= f.text_field :antiguedad %>
	</div>
	<div class="camposInline field">
		<span class="obligatorio">&nbsp</span>
		<%= f.label "Superficie cubierta"%>
		<%= f.text_field :superficie, :class=>"campoCorto" %>
	</div>
	<div class="field camposInline">
		<span class="obligatorio">&nbsp</span>
		<%= f.label "Superficie No Cubierta" %>
		<%= f.text_field :superficie_nc, :class=>"campoCorto" %>
	</div>
	<div class="field camposInline" id="opc_dormitorios" style="display:none;">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :dormitorios %>
		<%= f.text_field :dormitorios %>
	</div>
	<div class="field camposInline" id="opc_ambientes" style="display:none;">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :ambientes %>
		<%= f.text_field :ambientes %>
	</div>
	<div class="field center">
		<h2>Amenities</h2>
		<hr>	
		<% r1 = @amenities[0..3] %>
		<% r2 = @amenities[4..7] %>
		<% r3 = @amenities[8..11] %>
		<% r4 = @amenities[12..15] %>
		<% r5 = @amenities[16..19] %>
		<% r6 = @amenities[20..20] %>
		<table id="tablaAmenities">
			<tr>
				<% r1.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>
			<tr>
				<% r2.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>
			<tr>
				<% r3.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>
			<tr>
				<% r4.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>
			<tr>
				<% r5.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>
			<tr>
				<% r6.each do |a| %>
				<td>
					<%= f.label a.nombre %>
				</td>
				<td>
					<% if @propiedad.amenities.find_by_nombre(a.nombre)%>
					<%= check_box(:tieneamenities, a.nombre, checked: "checked") %>
					<% else  %>
					<%= check_box(:tieneamenities, a.nombre) %>
					<% end  %>
				</td>
				<% end  %>
			</tr>

		</table>
	</div>

	<br>
	<h2>Precio</h2>
	<hr>
	<div class="field">
		<div class="camposInline">
			<span class="obligatorio">*</span>
			<%= f.label :precio %>
			<%= f.text_field :precio %>
		</div>
		<div class="camposInline">
			<span class="obligatorio">&nbsp</span>
			<%= f.label :moneda_id %>
			<%= f.collection_select :moneda_id, Moneda.all, :id, :nombre, :selected => @propiedad.moneda_id %>
		</div>
	</div>

	<div class="field camposInline" id="opc_expensas" style="display:none;">
		<span class="obligatorio">&nbsp</span>
		<%= f.label :expensas %>
		<%= f.text_field :expensas %>
	</div>

	<br>
	<%= render :partial => "formTarjeta", :locals => { :f => f } %>
	<br>
		
	<div class="field">
	<%= f.hidden_field :user_id, :value => current_user.id %>
	</div>

	<div class="actions center">
		<%= f.submit %>
	</div>
	<% end %>
</div>
<script type="text/javascript">
	function myFunction() {
		window.location.reload(false);
	}
</script>
<script>
$(document).ready(function() {
	
	<% if params[:action] == "new"	|| params[:action] == "create" %>
	  $('#mapa').hide();
	<% end %>
	
 	<% if params[:action] != "new"	&& params[:action] != "create" %>
	  $('#datosTarjeta').hide();
	<% end %>	
	
	<% if !@propiedad.latitude 	%>
	  $('#mapa').hide();
	<% end %>	
});
</script>